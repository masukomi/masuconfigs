#!/bin/sh
# Most of this was derived from this helpful post
# about doing this with automator, but there was a bug in it,
# so I extracted the useful bits and made it a cleaner
# shell script
# https://filipmolcik.com/convert-png-to-icns-right-click-converter/



if [ $# -ne 1 ]; then
	echo "Please pass in the path to the file you wish to create"
	echo "an icon from."
	exit 1
fi

BASEDIR=$(dirname $1)
NEWDIR=$BASEDIR"/new_icon.iconset"
mkdir -p $NEWDIR


sips -z 16 16     $1 --out $NEWDIR/icon_16x16.png
sips -z 32 32     $1 --out $NEWDIR/icon_16x16@2x.png
sips -z 32 32     $1 --out $NEWDIR/icon_32x32.png
sips -z 64 64     $1 --out $NEWDIR/icon_32x32@2x.png
sips -z 128 128   $1 --out $NEWDIR/icon_128x128.png
sips -z 256 256   $1 --out $NEWDIR/icon_128x128@2x.png
sips -z 256 256   $1 --out $NEWDIR/icon_256x256.png
sips -z 512 512   $1 --out $NEWDIR/icon_256x256@2x.png
sips -z 512 512   $1 --out $NEWDIR/icon_512x512.png

cd $BASEDIR
iconutil -c icns $NEWDIR
FILENAME=$(basename $1)
NEW_ICNS_FILENAME=${FILENAME%%.*}".icns"
mv new_icon.icns $NEW_ICNS_FILENAME
rm -rf $NEWDIR

echo ""
echo "DONE. CREATED $NEW_ICNS_FILENAME"
