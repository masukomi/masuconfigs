#!/bin/sh

# Greps for the DEF of a Ruby / Crystal / Elixir function
# or a Rails scope definition

WHAT=$1
WHERE=$2
if [ "$WHERE" = "" ]; then
  WHERE="*"
fi
echo "Searching for definitions of: $WHAT"
echo "Looking in: $WHERE"
# finds
#   def foo      (elixir / ruby / crystal)
#   def self.foo (ruby / crystal)
#   defp foo     (elixir)
#   defmacro     (elixir)
grep -rn $WHAT $WHERE 2>/dev/null | egrep --colour=never "[[:space:]]*defp? $WHAT|[[:space:]]*def self.$WHAT|[[:space:]]*scope :$WHAT|[[:space:]]*defmacro $WHAT" \
  | egrep -v "tags:" \
  | grep -v ".js:" \
  | grep -v ".log:" \
  | grep --colour=auto $WHAT # last grep to add colour to results
if [[ $? -ne 0 ]]; then
	echo "none found ðŸ˜•"
fi
