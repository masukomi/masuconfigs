#!/bin/sh

# USAGE:
# pipe a backtrace into this and it'll tell you what's on each of
# those lines.
# ASSUMPTIONS:
# * assume's you're in macOS because searches for `/Users` to know it's
#   the start of a file path
# * assumes a backtrace format of .*<file>:<line number>:<ignorable crap>
YELLOW=$'\e[1;33m'
RED=$'\e[0;31m'
GREEN=$'\e[0;32m'
RESET="\033[0m"
while read LINE
do
	if [[ "$LINE" = *"/Users/"* ]]; then
		CODE=$(echo $LINE \
			| sed -e "s/.*\/Users/FILE=\/Users/" \
			| gsed -E "s/:([[:digit:]]*):(.*)/\necho \${YELLOW}\"\$FILE:\1\"\${RESET} \"\2\"\ncat \$FILE | sed -n \1p/" \
			|  tr '`' "'" )
		# echo "LINE: $LINE"
		# echo "$CODE"
		eval "$CODE"
	else
		echo "${GREEN}$LINE${RESET}"
    fi
done
