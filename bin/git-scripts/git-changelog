#!/usr/bin/env bash

# USAGE: git changelog [org|md]
# defaults to org mode format if not specified


# DEPENDENCY NOTE: requires git-show-tag-message to be in the path
# (found in the current folder of the original repo of this)

# FORMATTING NOTE
# Assumes the messages in your tags look like this:
#
#
# v1.2.3
#
# [some heading]
# - some heading specific item
# - some other item
#
# [another heading]
# - some heading specific item
# - some other item



FORMAT="$1"

if [ "$FORMAT" == "" ]; then
  FORMAT="org"
fi

for tag in $(git tag -l | sort -r); do
  if [ "$FORMAT" == "org" ]; then
    echo "* $(git show-tag-message $tag | sed -e 's/\[/** \[/')"
  elif [ "$FORMAT" == "md" ]; then
    echo "# $(git show-tag-message $tag | sed -e 's/\[/## \[/')"
  else
    echo "\"$FORMAT\" is not a supported format option"
    exit 64 # EX_USAGE
  fi
  echo ""
done
