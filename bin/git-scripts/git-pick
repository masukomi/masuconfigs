#!/bin/bash

# Leverages FZF to let you find a local branch or pr
# using "fuzzy" searching.
#
# Usage git pick <branch|pr>

# The PR functionality assumes you've modified your
# git config so that you can checkout PRs locally
#
# [remote "origin"]
#    fetch = +refs/heads/*:refs/remotes/origin/*
#    url = git@github.com:joyent/node.git
#    fetch = +refs/pull/*/head:refs/remotes/origin/pr/*
#    # ^^^ that last line lets you `git checkout pr/1234`

if [ $1 = "branch" ]; then
  git branch -v \
    | grep -v " [[:xdigit:]]\{7\} \[gone\]" \
    | fzf \
    | awk '{print $1}' \
    | xargs git checkout

elif [ $1 = "pr" ]; then

  git branch -av \
    | grep "pr/[[:digit:]]" \
    | grep -v " [[:xdigit:]]\{7\} \[gone\]" \
    | perl -pe "s/remotes\/\S+?\///g" \
    | fzf \
    | awk '{print $1}' \
    | xargs git checkout

else
  echo "Unrecognized option"
  echo "Usage: git pick [branch|pr]"
  exit 1
fi


